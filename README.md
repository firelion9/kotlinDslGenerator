# The Kotlin DSL generator

## How to use

### Apply plugin

Clone this repo to your computer and run `./gradlew publishToMavenLocal`.
After this, add buildscript dependency and apply plugin
to your build.gradle.kts file 
(for build.gradle change `apply(plugin = "com.firelion.dslgen")`
to `apply(plugin: "com.firelion.dslgen")`):

<!--- @hardlink#001 (version in gradlePlugin dependency) -->
```kotlin
buildscript {
    repositories {
//         ...
        mavenLocal()
    }
    dependencies {
//        ...         
      classpath("com.firelion.dslgen:gradlePlugin:0.3.0")
    }
}

apply(plugin = "com.firelion.dslgen")
//...
```

### Annotate a function
Apply `@GenerateDsl(MyDslMarker::class)` to a top-level function or constructor to generate a DSL for it.
`MyDslMarker` should be an annotation class with at least binary retention 
applicable to functions, types and classes and marked with `@DslMarker`:
```kotlin
@DslMarker
@Retention(AnnotationRetention.BINARY)
@Target(AnnotationTarget.CLASS, AnnotationTarget.TYPE, AnnotationTarget.FUNCTION, AnnotationTarget.PROPERTY)
annotation class MyDslMarker
```
You can modify DSL generation using `@UseDefaultConstructions` and `@UseAlternativeConstruction`.

## Limitations

* Updating to a newer version may break binary compatibility of generated DSL

* Member functions of classes with type parameters are unsupported

* Experimental implicit receivers (added with context()) are unsupported

* You can't suppress any warning generated by DSL generator

* `@GenerateDsl.makeInline` is currently treated as `true` 
  (all generated functions will have inline modifier)

* `@GenerateDsl.monoParameter` is currently unsupported and possibly will be never supported

* By default, DSL generator recursively generates sub-DSL with the same marker for each parameter.
  If you have more than one different marker, marker for common sub-DSL functions of different DSLs is undefined,
  so you possibly should stop generation of sub-DSL at some point
  using `@UseDefaultConstructions` with respective parameters 
  (`useDefaultSubDslConstruction`, `useSubFunctionSetter`, `useSubFunctionAdder`) set to `false` OR
  specify explicit DSL marker using `@GenerateDsl`

* Default arguments are supported only on JVM target through bytecode hacking.
  You can disable this feature by adding respective argument to KSP in build.gradle.kts file:
  ```kotlin
  extensions.configure<KspExtension> {
    arg("com.firelion.dslgen.allowDefaultArguments", "false")
  }
  ```